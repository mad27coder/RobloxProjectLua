--  Global Settings
getgenv().autoThank = false
getgenv().promoSpam = false
getgenv().autoFlyToDeath = true

--  Services
local Players = game:GetService("Players")
local TextChatService = game:GetService("TextChatService")
local VirtualUser = game:GetService("VirtualUser")
local StarterGui = game:GetService("StarterGui")
local player = Players.LocalPlayer
local chat = TextChatService:WaitForChild("TextChannels"):WaitForChild("RBXGeneral")

--  Anti-AFK
player.Idled:Connect(function()
	VirtualUser:CaptureController()
	VirtualUser:ClickButton1(Vector2.new(0, 0))
end)

--  Notification
StarterGui:SetCore("SendNotification", {
	Title = "✅ Script Executed",
	Text = "Auto Thank, Promo, Death Marker & Fly enabled.",
	Duration = 4
})

--  GUI Setup
local ScreenGui = Instance.new("ScreenGui", player:WaitForChild("PlayerGui"))
ScreenGui.Name = "AutoGUI"
ScreenGui.ResetOnSpawn = false

local Frame = Instance.new("Frame", ScreenGui)
Frame.Size = UDim2.new(0, 220, 0, 200)
Frame.Position = UDim2.new(0.5, -110, 0.5, -100)
Frame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
Frame.Active = true
Frame.Draggable = true

local toggleButton = Instance.new("TextButton", ScreenGui)
toggleButton.Size = UDim2.new(0, 40, 0, 40)
toggleButton.Position = UDim2.new(1, -45, 0.5, -20)
toggleButton.BackgroundColor3 = Color3.fromRGB(90, 90, 90)
toggleButton.TextColor3 = Color3.new(1, 1, 1)
toggleButton.Text = "≡"
toggleButton.ZIndex = 10
toggleButton.Active = true
toggleButton.Draggable = true

local guiVisible = true
toggleButton.MouseButton1Click:Connect(function()
	guiVisible = not guiVisible
	Frame.Visible = guiVisible
end)

--  GUI Elements
local ThankButton = Instance.new("TextButton", Frame)
ThankButton.Size = UDim2.new(0, 200, 0, 40)
ThankButton.Position = UDim2.new(0, 10, 0, 10)
ThankButton.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
ThankButton.TextColor3 = Color3.new(1, 1, 1)

local PromoButton = Instance.new("TextButton", Frame)
PromoButton.Size = UDim2.new(0, 200, 0, 40)
PromoButton.Position = UDim2.new(0, 10, 0, 60)
PromoButton.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
PromoButton.TextColor3 = Color3.new(1, 1, 1)

local FlyToggle = Instance.new("TextButton", Frame)
FlyToggle.Size = UDim2.new(0, 200, 0, 40)
FlyToggle.Position = UDim2.new(0, 10, 0, 110)
FlyToggle.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
FlyToggle.TextColor3 = Color3.new(1, 1, 1)

local StatusLabel = Instance.new("TextLabel", Frame)
StatusLabel.Size = UDim2.new(0, 200, 0, 20)
StatusLabel.Position = UDim2.new(0, 10, 0, 155)
StatusLabel.BackgroundTransparency = 1
StatusLabel.TextColor3 = Color3.new(1, 1, 1)
StatusLabel.TextScaled = true

local SignatureLabel = Instance.new("TextLabel", Frame)
SignatureLabel.Size = UDim2.new(0, 200, 0, 20)
SignatureLabel.Position = UDim2.new(0, 10, 1, -25)
SignatureLabel.BackgroundTransparency = 1
SignatureLabel.TextColor3 = Color3.new(1, 1, 1)
SignatureLabel.Text = "LYNX x DHINZ"
SignatureLabel.Font = Enum.Font.SourceSansBold
SignatureLabel.TextScaled = true

local function updateGUI()
	ThankButton.Text = "Toggle Auto Thank (" .. (getgenv().autoThank and "ON" or "OFF") .. ")"
	PromoButton.Text = "Toggle Auto Promo (" .. (getgenv().promoSpam and "ON" or "OFF") .. ")"
	FlyToggle.Text = "Toggle Auto Fly (" .. (getgenv().autoFlyToDeath and "ON" or "OFF") .. ")"
	StatusLabel.Text = "Status: Thank " .. (getgenv().autoThank and "ON" or "OFF") ..
		" / Promo " .. (getgenv().promoSpam and "ON" or "OFF") ..
		" / Fly " .. (getgenv().autoFlyToDeath and "ON" or "OFF")
end

updateGUI()

--  Messages
local thankMessages = {
	"Thank you so much! With that donation, my avatar can finally stop eating imaginary noodles. Ramen is great, but air ramen? Not so much.",
}

local promoMessages = {
	"Support the cause! Every bit helps. ",
	"Join the movement! Your donation makes a difference.",
	"Thanks for being awesome! Keep the support coming!",
}

--  Promo Delay System
local promoDelayUntil = 0
local promoPauseOnDonation = 36

local function getRandomPromoInterval()
	return math.random(15, 20)
end

--  Shuffle
local function shuffle(array)
	local shuffled, indices = {}, {}
	for i = 1, #array do table.insert(indices, i) end
	for i = #indices, 2, -1 do
		local j = math.random(i)
		indices[i], indices[j] = indices[j], indices[i]
	end
	for _, i in ipairs(indices) do
		table.insert(shuffled, array[i])
	end
	return shuffled
end

local shuffledPromo = shuffle(promoMessages)
local shuffledIndex = 1

--  Auto Promo Logic
task.spawn(function()
	while true do
		if getgenv().promoSpam then
			local currentTime = tick()
			if currentTime >= promoDelayUntil then
				if chat then
					local msg = shuffledPromo[shuffledIndex]
					chat:SendAsync(msg)
					shuffledIndex += 1
					if shuffledIndex > #shuffledPromo then
						shuffledPromo = shuffle(promoMessages)
						shuffledIndex = 1
					end
				end
				promoDelayUntil = currentTime + getRandomPromoInterval()
			end
		end
		task.wait(1)
	end
end)

--  Auto Thank Logic + BreakJoints + Promo Pause
local leaderstats = player:WaitForChild("leaderstats")
local raisedStat = leaderstats:WaitForChild("Raised")
local lastRaised = raisedStat.Value

raisedStat.Changed:Connect(function()
	if getgenv().autoThank then
		local newRaised = raisedStat.Value
		if newRaised > lastRaised then
			if chat then
				local msg = thankMessages[math.random(1, #thankMessages)]
				chat:SendAsync(msg)
			end
			lastRaised = newRaised

			--  Break joints after 5 seconds
			task.delay(5, function()
				if player.Character then
					player.Character:BreakJoints()
				end
			end)
		end
	end
	promoDelayUntil = tick() + promoPauseOnDonation
end)

--  Button Logic
ThankButton.MouseButton1Click:Connect(function()
	getgenv().autoThank = not getgenv().autoThank
	updateGUI()
end)

PromoButton.MouseButton1Click:Connect(function()
	getgenv().promoSpam = not getgenv().promoSpam
	updateGUI()
end)

FlyToggle.MouseButton1Click:Connect(function()
	getgenv().autoFlyToDeath = not getgenv().autoFlyToDeath
	updateGUI()
end)

--  Death Marker + Auto Fly
local marker = nil

local function createDeathMarker(position)
	if marker then marker:Destroy() end
	marker = Instance.new("Part")
	marker.Anchored = true
	marker.CanCollide = false
	marker.Size = Vector3.new(1,1,1)
	marker.Position = position
	marker.Transparency = 1
	marker.Name = "DeathMarker"
	marker.Parent = workspace
end

local function destroySit(humanoid)
	task.spawn(function()
		while humanoid and humanoid.Parent do
			humanoid.Sit = false
			humanoid.SeatPart = nil
			task.wait(0.1)
		end
	end)
end

local function flyToMarker(humanoid, root)
	if not marker then return end
	local targetPos = marker.Position + Vector3.new(0, 5, 0)